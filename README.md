# Word・PDF 画像抽出・差し替えツール

会社ロゴ変更に伴う、.docx/.pdfファイル内の画像を半自動で差し替えるPythonツール

## 機能

### 1. ファイル検索・画像抽出機能 (`file_extractor.py`)

- ディレクトリを再帰的にクロールして.docx/.pdfファイルを検索
- 画像が含まれているファイルのみを抽出
- 各ファイルから最大3つの画像を抽出・リサイズ（100px×100px）
- ExcelファイルにA列:ファイルパス、B-D列:画像プレビューで出力

### 2. 画像差し替え機能 (`image_replacer.py`) ✨新機能

- CSVファイルの指示に基づいてWordファイルの画像を自動差し替え
- 元のディレクトリ構造を維持したまま出力
- タイムスタンプ付きディレクトリに編集済みファイルを保存

## 使用方法

### 画像抽出（現在のファイル一覧と画像確認）

```bash
python file_extractor.py
```

### 画像差し替え

1. `order_edit_image.csv`ファイルに差し替え指示を記載
2. 以下のコマンドで実行:

```bash
python image_replacer.py
```

## CSVファイル形式

`order_edit_image.csv`の形式:

| 列 | 項目 | 説明 |
|---|------|------|
| A | ファイルパス | 差し替え対象のファイル |
| B-D | image1-3 | 参照用（抽出済み画像プレビュー） |
| F | 修正先① | image1/image2/image3のいずれか |
| G | 修正画像① | 差し替え用画像のパス |
| H | 修正先② | image1/image2/image3のいずれか |
| I | 修正画像② | 差し替え用画像のパス |

## 処理フロー

1. **ファイル検索・画像抽出**
   - `file_extractor.py`でファイル一覧と画像を確認
   - `画像含有ファイル検索結果.xlsx`が生成される

2. **差し替え指示作成**
   - ExcelまたはCSVエディタで`order_edit_image.csv`を編集
   - 各ファイルの画像番号（image1-3）と差し替え画像パスを指定

3. **画像差し替え実行**
   - `image_replacer.py`でCSVの指示に基づいて自動差し替え
   - `edit_data/replaced_[timestamp]/`ディレクトリに出力

## 対応ファイル形式

### 完全対応
- ✅ **Wordファイル (.docx)**: 画像抽出・差し替え両方対応

### 部分対応  
- ⚠️ **PDFファイル (.pdf)**: 画像抽出のみ対応（差し替えは要追加ライブラリ）

## 実行例

### 画像差し替え処理の結果例

```
============================================================
画像差し替え処理開始
============================================================
差し替え対象ファイル数: 32
出力ディレクトリ: edit_data\replaced_20250603_224016
------------------------------------------------------------
処理中: .\test_directry\data\img_food_word.docx
  → 差し替え指示数: 2
  → Wordファイルの画像差し替え開始
    → 検出された画像ファイル数: 6
    → image1 を差し替えました: buranko_girl_sad.png
    → image2 を差し替えました: asobu_cat_shadow.png
  → 差し替え完了
============================================================
画像差し替え処理完了
成功: 20 ファイル
失敗: 12 ファイル (PDFファイルは現在未対応)
============================================================
```

## 依存関係

```
pandas>=2.0.0
openpyxl>=3.1.0
PyPDF2>=3.0.0
Pillow>=10.0.0
```

## インストール

```bash
pip install -r requirements.txt
```

## 出力ファイル

- `画像含有ファイル検索結果.xlsx`: 画像抽出結果
- `edit_data/replaced_[timestamp]/`: 画像差し替え完了ファイル

## エラーハンドリング

- ファイルアクセス権限チェック
- 画像形式対応（RGBA→RGB変換）
- PDF暗号化対応（空パスワード復号試行）
- ファイルサイズ制限（10MB上限）
- 一時ファイルの適切なクリーンアップ
- CSVエンコーディング自動検出（CP932/Shift-JIS/UTF-8対応）

## 今後の拡張予定

- PDFファイルの画像差し替え対応（PyMuPDF等のライブラリ追加）
- GUI版の開発
- 一括処理のバッチスクリプト化 